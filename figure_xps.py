import numpy as np
from pdos_helper import dos_grid_general,get_alpha,get_ao_ind, get_ind_ao_underc
from matplotlib import pyplot as plt
import random

#For Pristine Medium Spherical Dot
#cebes = np.array([137.1349706, 139.2998412, 138.2030437,138.2278638,137.0194795,138.2218786,136.7711176,138.4305403,138.7684211,136.3770616,136.320669,136.3105549,136.5138134,136.4895469,136.4518194,136.2565242,136.4386645,136.2130149,138.4193703,136.4394272,136.3666261,136.4001372,136.3410171,136.3683374,136.1489716,136.1077536,136.1151081,135.9112406,135.9126455,136.0216599,136.012079,135.8909583,136.0053032,135.9921437,135.9910897,135.9824103,135.9677608,135.9425192,135.9043975,135.8357831,135.8289227,135.9264825,135.8201304,135.925615,137.6652869,135.8130148,135.9186772,135.8084623,135.8025815,135.9921824,135.9025021,135.8936802,135.8891947,135.8800355,135.8520027,135.8531813,135.9358385,135.9104725,135.7342638,135.732845,135.8329146,135.732492,135.8796812,135.8193171,135.8219347,135.9260898,135.9030479,135.8852659,135.802904,135.8020098,135.8181049,135.8041059,135.8475874,135.8435529,135.8272412,135.7871934,135.8033542,135.731759,135.8167305,135.7869432,135.7038615,135.5693161,135.5627922,135.5595771,135.5382464,135.5342002,135.5241414,135.5237706,135.5185994,135.5135546,135.6405179,135.6191581,135.5339261,135.4640712,135.5537248,135.4288935,135.4230917,135.4254308,135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4, 135.4])
#cebes1= np.array([136.77, 138.43, 138.77, 137.1349706,139.2998412,138.2030437,138.2278638,137.0194795,138.2218786,138.4193703,137.6652869]) 
#cebes2 = np.array([136.51, 136.49, 136.45,136.39,136.39,136.39,136.39,136.39,136.39])
#cebes3 = np.array([135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.91, 135.87, 135.87, 135.87, 135.87, 135.87, 135.87, 135.87, 135.87, 135.87, 135.54, 135.54, 135.54, 135.54, 135.54, 135.54, 135.54, 135.54, 135.54])
#cebes4=np.array([135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82, 135.82])
#cebes5 = np.array([135.75,135.75,135.75,135.75,135.75,135.75,135.75,135.75,135.75,135.46,135.46,135.46,135.46,135.46,135.46,135.46,135.46,135.46, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.35, 135.4,135.4,135.4,135.4,135.4,135.4,135.4,135.4,135.4])
#cebes6=np.array([136.23, 136.23, 136.23, 136.23, 136.23, 136.23, 136.23, 136.23, 136.23])
#cebes7=np.array([135.85,135.85,135.85,135.85,135.85,135.85,135.85,135.85,135.85])

#For InP 4p 442
cebes=np.array([137.1688576,138.2899761,138.112246,138.913815,138.7450971,136.7072598,136.6911861,136.6400765,136.5836459,136.2940405,136.5049464,136.4705108,136.2509498,136.2479189,136.4436839,136.1155649,136.071234,136.066913,135.9259591,135.9148581,135.8869445,135.92849,135.85861,135.9230035,135.899712,135.8163793,135.8377094,135.8240757,135.8933265,135.9913271,135.7929529,135.7896538,135.8168392,135.9732062,135.8072858,135.7918435,135.860142,135.8543821,137.0803732,135.833542,135.841442,135.8120868,135.8234531,135.8277919,135.9033759,135.7332075,135.8160062,135.8081553,135.915451,135.7228735,135.7197199,135.8018765,135.8652101,135.8739735,135.8291451,135.7798228,135.6599051,135.7768356,135.811029,135.8906658,135.6366574,135.8663115,135.7066311,135.8338173,135.7029941,135.774431,135.6488241,135.6417953,135.6014992,135.6003401,135.6259228,135.6647574,135.7728862,135.5204263,135.7436379,135.5189597,135.5804178,135.5768628,135.5762895,135.5700011,135.5071836,135.5507948,135.5427469,135.6280174,135.6252026,135.5241343,135.6057783,135.585138,135.4943767,135.5025095,135.4601939,135.4136474,135.3944326,135.385135,135.3529259,135.3509828,135.3189737,135.2995934,135.3016114,135.2711089,135.2821978,135.2477221,135.2476388,135.1945678,135.2350768,135.1444595,135.2332774,135.2025902,135.1128619,135.1879902])
cebes1=np.array([137.1688576,138.2899761,138.112246,138.913815,138.7450971,136.7072598])
cebes2=np.array([136.6911861,136.6400765,136.5836459,136.5049464,136.4705108,136.4436839])
cebes3=np.array([136.2940405,136.2509498,136.2479189,136.1155649,136.071234,136.066913,135.8933265,137.0803732,135.8120868])
cebes4=np.array([135.9259591,135.9148581,135.8869445,135.8377094,135.8168392,135.8072858,135.92849,135.9230035,135.899712,135.860142,135.8543821,135.841442,135.8277919,135.8081553,135.8234531,135.8160062,135.8018765,135.7332075,135.7228735,135.719719,135.8291451,135.7798228,135.7768356,135.7066311,135.7029941,135.6647574,135.6488241,135.6417953,135.6259228,135.5204263,135.5189597,135.5071836,135.5768628,135.5762895,135.5507948,135.6280174,135.6252026,135.6057783,135.5241343,135.585138,135.4943767,135.4136474,135.3944326,135.385135,135.3509828,135.3189737,135.2995934])
cebes5 = np.array([135.85861,135.8240757,135.7918435,135.8163793,135.7929529,135.7896538,135.915451,135.8652101,135.8906658,135.8338173])
cebes6 = np.array([135.9913271,135.9732062,135.9033759,135.8739735,135.811029,135.774431,135.6599051,135.6366574,135.6014992,135.6003401,135.8663115,135.7728862,135.7436379])
cebes7 = np.array([135.5804178,135.5700011,135.5427469,135.5025095,135.4601939,135.3529259,135.3016114,135.2711089,135.2821978,135.2477221,135.2476388,135.1945678,135.2350768,135.1444595,135.2332774,135.2025902,135.1128619,135.1879902])

fwhm = 0.5
sigma = fwhm / 2.355

E_grid = np.arange(120,140,0.01)

#full
E_grid_reshape=np.broadcast_to(E_grid,(len(cebes),len(E_grid)))
cebes_reshape=np.broadcast_to(cebes,(len(E_grid),len(cebes))).T

deltaE=E_grid_reshape-cebes_reshape
deltaE2 = np.power(deltaE,2)

exp_eorb = np.exp(-(deltaE2)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)

exp_eorb=np.sum(exp_eorb,axis=0)

#individual
E_grid_reshape1=np.broadcast_to(E_grid,(len(cebes1),len(E_grid)))
cebes_reshape1=np.broadcast_to(cebes1,(len(E_grid),len(cebes1))).T
deltaE1=E_grid_reshape1-cebes_reshape1
deltaE21 = np.power(deltaE1,2)
exp_eorb1 = np.exp(-(deltaE21)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb1=np.sum(exp_eorb1,axis=0)

E_grid_reshape2=np.broadcast_to(E_grid,(len(cebes2),len(E_grid)))
cebes_reshape2=np.broadcast_to(cebes2,(len(E_grid),len(cebes2))).T
deltaE2=E_grid_reshape2-cebes_reshape2
deltaE22 = np.power(deltaE2,2)
exp_eorb2 = np.exp(-(deltaE22)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb2=np.sum(exp_eorb2,axis=0)

E_grid_reshape3=np.broadcast_to(E_grid,(len(cebes3),len(E_grid)))
cebes_reshape3=np.broadcast_to(cebes3,(len(E_grid),len(cebes3))).T
deltaE3=E_grid_reshape3-cebes_reshape3
deltaE23 = np.power(deltaE3,2)
exp_eorb3 = np.exp(-(deltaE23)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb3=np.sum(exp_eorb3,axis=0)

E_grid_reshape4=np.broadcast_to(E_grid,(len(cebes4),len(E_grid)))
cebes_reshape4=np.broadcast_to(cebes4,(len(E_grid),len(cebes4))).T
deltaE4=E_grid_reshape4-cebes_reshape4
deltaE24 = np.power(deltaE4,2)
exp_eorb4 = np.exp(-(deltaE24)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb4=np.sum(exp_eorb4,axis=0)

E_grid_reshape5=np.broadcast_to(E_grid,(len(cebes5),len(E_grid)))
cebes_reshape5=np.broadcast_to(cebes5,(len(E_grid),len(cebes5))).T
deltaE5=E_grid_reshape5-cebes_reshape5
deltaE25 = np.power(deltaE5,2)
exp_eorb5 = np.exp(-(deltaE25)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb5=np.sum(exp_eorb5,axis=0)

E_grid_reshape6=np.broadcast_to(E_grid,(len(cebes6),len(E_grid)))
cebes_reshape6=np.broadcast_to(cebes6,(len(E_grid),len(cebes6))).T
deltaE6=E_grid_reshape6-cebes_reshape6
deltaE26 = np.power(deltaE6,2)
exp_eorb6 = np.exp(-(deltaE26)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb6=np.sum(exp_eorb6,axis=0)

E_grid_reshape7=np.broadcast_to(E_grid,(len(cebes7),len(E_grid)))
cebes_reshape7=np.broadcast_to(cebes7,(len(E_grid),len(cebes7))).T
deltaE7=E_grid_reshape7-cebes_reshape7
deltaE27 = np.power(deltaE7,2)
exp_eorb7 = np.exp(-(deltaE27)/(2*sigma**2))/np.sqrt(2*np.pi*sigma**2)
exp_eorb7=np.sum(exp_eorb7,axis=0)


plt.figure()
plt.plot(E_grid,exp_eorb,'C0',label='Full XPS')
plt.plot(E_grid,exp_eorb4,'C3',label='4-Coordinate P')
plt.plot(E_grid,exp_eorb5+exp_eorb6,'C4',label='P Associated with Dimers')
#plt.plot(E_grid,exp_eorb6,'C5',label='P on 3-Coordinate Indium')
plt.plot(E_grid,exp_eorb3,'C6',label='P on 3-Coordinate In')
plt.plot(E_grid,exp_eorb2,'C2',label='P on In-1P')
plt.plot(E_grid,exp_eorb1,'C1',label='P on 3-Coordinate In-1P')
plt.plot(E_grid,exp_eorb7,'C7',label='3-Coordinate P')
plt.legend()
plt.xlim(140,134)
plt.ylim(0,120)
plt.ylabel('CPS')
plt.xlabel('CEBE (eV)')
plt.title("In55P40F45 P 2p XPS Spectrum")
#plt.axvline(x=128.9, ymax=0.5,color="C1")
#plt.axvline(x=130.1, ymax=0.5,color="C2")
#plt.axvline(x=130.8, ymax=0.5,color="C3")
#plt.axvline(x=131.2, ymax=0.5,color="C4")
#plt.axvline(x=131.7, ymax=0.5,color="C5")
#plt.axvline(x=129.3, ymax=0.5,color="C6")
#plt.axvline(x=127.6, ymax=0.5,color="C7")
#plt.axvline(x=128.5, ymax=0.5,color="C9")
plt.savefig('spectrum.pdf')
plt.show()